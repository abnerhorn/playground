---
description: Coding conventions and rules
globs: ["**/*"]
---

# Coding Rules

> **What is this file?**
> This file tells Cursor AI how to write code in your project.
> It enforces consistent patterns and catches common mistakes.
> Update this file when you establish new conventions.

## Code Style

### TypeScript
- Use strict mode
- Prefer explicit types over `any`
- Use path aliases: `@/lib/*`, `@/components/*`, `@/app/*`

### React/Next.js
- Use Server Components by default
- Add `'use client'` only when hooks/interactivity are needed
- Use `useCallback` and `useMemo` for performance in client components
- Prefer async Server Components for data fetching

### Components
- Functional components only
- Props interfaces defined inline or in same file
- Use `cn()` utility from `@/lib/utils/cn` for conditional classes
- Check `components/ui/` (shadcn) before creating new UI components

### Styling
- Use Tailwind CSS exclusively
- Dark mode: Use `dark:` prefix
- Use custom typography scale: `text-title`, `text-body`, `text-section`
- Use `can-hover:` variant for navigation links (prevents iOS sticky hover)

## Centralized Configs

| Need | Location |
|------|----------|
| Site content | `lib/site-config.ts` |
| Shared styles | `lib/styles.ts` |
| Keyboard shortcuts | `lib/keyboard/shortcuts.ts` |
| SVG icons | `components/Icons.tsx` |

## API Routes
- Return JSON responses
- Use `withSession()` or `withAdmin()` HOC from `@/lib/auth`
- Use proper HTTP status codes (401, 403, 404, 400)
- Validate request bodies with Zod schemas
- Co-locate schemas with routes or in `lib/schemas/`

## Database
- Use singleton Prisma client from `@/lib/db`
- Keep queries in Server Components or API routes
- Handle edge cases (not found, already exists)

## Touch/Mobile
- Use `TapLink` for nav links (iOS scroll detection)
- Add `overscroll-contain` to scrollable containers
- Support `prefers-reduced-motion`

## Don't
- Don't use inline styles
- Don't put business logic in components (use lib/)
- Don't commit `.env.local` files
- Don't use raw Tailwind font sizes (`text-sm`, `text-lg`)
- Don't duplicate values â€” abstract them
- Don't create UI components when shadcn has one

## Do
- Keep components small and focused
- Use semantic HTML
- Handle loading and error states
- Check existing abstractions before creating new ones
- Add explainer comments to new files

## Git Workflow

This project uses **Conventional Commits** enforced by commitlint + husky.

### Commit Message Format
```
<type>(<scope>): <subject>

[optional body]
```

**Types:**
| Type | Use for |
|------|---------|
| `feat` | New feature |
| `fix` | Bug fix |
| `docs` | Documentation only |
| `style` | Formatting, no code change |
| `refactor` | Code restructuring |
| `perf` | Performance improvement |
| `test` | Adding/updating tests |
| `build` | Build system, dependencies |
| `ci` | CI/CD changes |
| `chore` | Maintenance tasks |

**Examples:**
- `feat(auth): add Google OAuth login`
- `fix(api): handle null user in session`
- `docs: update README setup instructions`
- `chore: update dependencies`

### Git Shortcuts

| Shortcut | Action |
|----------|--------|
| `d` | Dev commit |
| `g` | Production commit |
| `p` | Pull latest |
| `s` | Status |
| `l` | Log |
| `b` | Branch |
| `r` | Revert |
| `m` | Merge |
| `c` | Conflicts |

### When user types "d" (dev commit)
1. `git add -A && git status -sb && git diff --staged --stat`
2. Review changes and determine commit type
3. Commit with conventional format: `git commit -m "<type>: <description>"`
4. Push to `dev` branch: `git push origin dev`

### When user types "g" (production commit)
**Only run when explicitly requested.**
1. If on dev: `git checkout main && git merge dev`
2. `git add -A`, commit with conventional format, push to main
3. Return to dev: `git checkout dev`

### When user types "p" (pull)
`git stash && git pull && git stash pop`

### When user types "s" (status)
`git status -sb && git branch -vv`
Show current branch, tracking info, and changed files.

### When user types "l" (log)
`git log --oneline -15 --graph --decorate`
Show last 15 commits with branch visualization.

### When user types "b" (branch)
1. Show current branches: `git branch -a`
2. Ask user what they want: create, switch, or delete
3. Execute requested action

### When user types "r" (revert)
1. Show last 5 commits: `git log --oneline -5`
2. Ask user what to revert: last commit, specific commit, or unstaged changes
3. Execute with appropriate command:
   - Unstaged changes: `git checkout -- .`
   - Last commit (keep changes): `git reset --soft HEAD~1`
   - Last commit (discard): `git reset --hard HEAD~1`

### When user types "m" (merge)
1. Show available branches: `git branch -a`
2. Ask which branch to merge into current
3. `git merge <branch>`
4. If conflicts, guide through resolution

### When user types "c" (conflicts)
1. `git status` to show conflicted files
2. List each conflicted file
3. Open each file and help resolve conflicts
4. After resolving: `git add <file>` and continue merge/rebase

## Planning Files

| File | Purpose |
|------|---------|
| `plans/Tomorrow.md` | Immediate tasks |
| `plans/Future.md` | Long-term ideas |
| `plans/tmp/` | Working drafts (gitignored) |

Use checkboxes in Tomorrow.md. Move completed items to Future.md or delete.
